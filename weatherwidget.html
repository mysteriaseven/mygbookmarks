<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Ankara Hava Durumu</title>
<style>
* { margin:0; padding:0; box-sizing:border-box; font-family:system-ui,sans-serif; }
body { background:linear-gradient(135deg,#667eea 0%,#764ba2 100%); padding:15px; }
.widget-container {
    background:rgba(255,255,255,0.95); border-radius:20px; box-shadow:0 10px 30px rgba(0,0,0,0.2);
    overflow:hidden; backdrop-filter:blur(10px); display:flex; min-height:260px;
}
.widget-header { background:linear-gradient(135deg,#667eea 0%,#764ba2 100%); padding:15px; color:white; position:relative; flex:1; min-width:200px; display:flex; flex-direction:column; justify-content:center; border-radius:20px 0 0 20px; }
.weather-animation { position:absolute; top:0; left:0; width:100%; height:100%; pointer-events:none; }
.rain-drop { position:absolute; width:2px; height:20px; background:linear-gradient(transparent,rgba(255,255,255,0.6)); animation:rain-fall linear infinite; }
@keyframes rain-fall { to { transform:translateY(300px); } }
.snow-flake { position:absolute; width:10px; height:10px; background:white; border-radius:50%; animation:snow-fall linear infinite; }
@keyframes snow-fall { to { transform:translateY(300px) rotate(360deg); } }
.sun-rays { position:absolute; top:50%; right:20px; font-size:40px; animation:rotate 20s linear infinite; }
@keyframes rotate { to { transform:rotate(360deg); } }
.district-selector select { width:100%; padding:8px; border:none; border-radius:10px; background:rgba(255,255,255,0.2); color:white; }
.current-temp { font-size:36px; font-weight:bold; }
.weather-icon-main { font-size:40px; }
.detail-item { display:flex; align-items:center; gap:4px; font-size:11px; }
.widget-body { padding:15px; flex:2; display:flex; flex-direction:column; border-radius:0 20px 20px 0; }
.section-title { font-weight:bold; color:#333; margin-bottom:8px; font-size:14px; }
.hourly-forecast, .daily-forecast { display:flex; gap:8px; overflow-x:auto; padding:5px 0; }
.hourly-forecast::-webkit-scrollbar, .daily-forecast::-webkit-scrollbar { height:4px; }
.hourly-forecast::-webkit-scrollbar-thumb, .daily-forecast::-webkit-scrollbar-thumb { background:#667eea; border-radius:10px; }
.hour-card, .day-card { background:linear-gradient(135deg,#667eea 0%,#764ba2 100%); color:white; border-radius:10px; padding:8px; text-align:center; min-width:60px; }
.day-card { background:rgba(102,126,234,0.1); border:1px solid transparent; }
.day-card:hover { border-color:#667eea; }
.loading { color:#667eea; padding:10px; text-align:center; }
</style>
</head>
<body>

<div class="widget-container">
    <div class="widget-header">
        <div class="weather-animation" id="weatherAnimation"></div>
        <div class="district-selector">
            <select id="districtSelect">
                <option value="Etimesgut">Etimesgut</option>
                <option value="Çankaya">Çankaya</option>
                <option value="Keçiören">Keçiören</option>
                <option value="Mamak">Mamak</option>
                <option value="Yenimahalle">Yenimahalle</option>
                <option value="Altındağ">Altındağ</option>
                <option value="Sincan">Sincan</option>
                <option value="Pursaklar">Pursaklar</option>
                <option value="Gölbaşı">Gölbaşı</option>
                <option value="Polatlı">Polatlı</option>
                <option value="Ankara Merkez">Ankara Merkez</option>
            </select>
        </div>
        <div class="current-weather">
            <div>
                <div class="current-temp" id="currentTemp">--°</div>
                <div id="weatherDesc">Yükleniyor...</div>
            </div>
            <div class="weather-icon-main" id="mainIcon">Cloud</div>
        </div>
        <div style="display:flex;gap:10px;flex-wrap:wrap;margin-top:10px;">
            <div class="detail-item">Humidity <span id="humidity">--%</span></div>
            <div class="detail-item">Wind <span id="wind">-- km/s</span></div>
            <div class="detail-item">Rain <span id="rainChance">--%</span></div>
        </div>
    </div>
    <div class="widget-body">
        <div class="section-title">Saatlik</div>
        <div class="hourly-forecast" id="hourlyForecast"><div class="loading">Yükleniyor...</div></div>
        <div class="section-title">Günlük</div>
        <div class="daily-forecast" id="dailyForecast"><div class="loading">Yükleniyor...</div></div>
    </div>
</div>

<script>
const API_KEY = 'cd6435a221fb4a71881124700252110';
const BASE_URL = 'https://api.weatherapi.com/v1';

function getIcon(code,isDay){const m={1000:isDay?'Sun':'Moon',1003:'Cloud-Sun',1006:'Cloud',1183:'Rain',1195:'Heavy-Rain',1063:'Cloud-Rain',1210:'Snow',1273:'Thunder'};return m[code]||'Cloud';}

function animate(code,el){
    el.innerHTML='';
    if(code>=1180&&code<=1246)for(let i=0;i<30;i++){let d=document.createElement('div');d.className='rain-drop';d.style.left=Math.random()*100+'%';d.style.animationDuration=(Math.random()*0.5+0.5)+'s';d.style.animationDelay=Math.random()*2+'s';el.appendChild(d);}
    else if(code>=1210&&code<=1225)for(let i=0;i<20;i++){let s=document.createElement('div');s.className='snow-flake';s.style.left=Math.random()*100+'%';s.style.animationDuration=(Math.random()*3+2)+'s';s.style.animationDelay=Math.random()*2+'s';el.appendChild(s);}
    else if(code===1000){let sun=document.createElement('div');sun.className='sun-rays';sun.textContent='Sun';el.appendChild(sun);}
}

async function fetchWeather(d){
    const res=await fetch(`${BASE_URL}/forecast.json?key=${API_KEY}&q=${d},Ankara,Turkey&days=3&lang=tr`);
    return res.ok ? await res.json() : null;
}

function update(data){
    if(!data)return;
    const c=data.current,f=data.forecast.forecastday;
    $('#currentTemp').textContent=Math.round(c.temp_c)+'°';
    $('#weatherDesc').textContent=c.condition.text;
    $('#mainIcon').textContent=getIcon(c.condition.code,c.is_day);
    $('#humidity').textContent=c.humidity+'%';
    $('#wind').textContent=c.wind_kph.toFixed(1)+' km/s';
    $('#rainChance').textContent=(f[0].day.daily_chance_of_rain||0)+'%';
    animate(c.condition.code,$('#weatherAnimation'));

    const hours=f.flatMap(d=>d.hour);
    const now=new Date().getHours();
    $('#hourlyForecast').innerHTML=hours.slice(now,now+12).map(h=>{const t=new Date(h.time);return`<div class="hour-card"><div>${t.getHours()}:00</div><div>${getIcon(h.condition.code,h.is_day)}</div><div>${Math.round(h.temp_c)}°</div><div>Rain ${h.chance_of_rain}%</div></div>`;}).join('');

    const days=['Pazar','Pazartesi','Salı','Çarşamba','Perşembe','Cuma','Cumartesi'];
    $('#dailyForecast').innerHTML=f.map((d,i)=>{const date=new Date(d.date);const name=i===0?'Bugün':days[date.getDay()];return`<div class="day-card"><div>${name}</div><div>${getIcon(d.day.condition.code,1)}</div><div>${Math.round(d.day.maxtemp_c)}° ${Math.round(d.day.mintemp_c)}°</div><div>Rain ${d.day.daily_chance_of_rain}%</div></div>`;}).join('');
}

function $(s){return document.querySelector(s);}
async function load(){const d=$('#districtSelect').value;const data=await fetchWeather(d);update(data);}
$('#districtSelect').addEventListener('change',load);
load(); setInterval(load,600000);
</script>
</body>
</html>
