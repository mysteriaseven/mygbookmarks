<!doctype html>
<html lang="tr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>My Bookmarks v1.9</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
<style>
:root{ --bg:linear-gradient(135deg, #667eea 0%, #764ba2 100%); --card:rgba(255, 255, 255, 0.95); --muted:#e0e6ff; --accent:#667eea; font-family:'Inter',sans-serif; }
html,body{margin:0;height:100%;background:var(--bg);color:#ffffff;}
.app{display:grid;grid-template-columns:280px 1fr;height:100vh;}
.sidebar{ background:linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-right:1px solid rgba(255,255,255,0.1); padding:20px; display:flex;flex-direction:column;gap:16px; color:#ffffff; }
#versionInfo { background: rgba(255, 255, 255, 0.2); color: #ffffff; padding: 3px 8px; border-radius: 8px; font-size: 12px; font-weight: 600; align-self: flex-start; margin-bottom: 8px; }
.brand{display:flex;align-items:center;gap:12px;}
.logo{ width:48px;height:48px;border-radius:50%; background:conic-gradient(from 180deg,#ffffff,#e0e6ff,#a8e6cf,#ffd93d,#ffffff); display:flex;align-items:center;justify-content:center; font-weight:800;color:#667eea;overflow:hidden; }
.logo img{width:100%;height:100%;border-radius:50%;object-fit:cover;}
h1{font-size:17px;margin:0;color:#ffffff;}
#sidebarSubtitleContainer{ display: flex; align-items: center; justify-content: space-between; font-size: 12px; color: var(--muted); margin-top: 4px; }
#miniSignOutBtn { background: rgba(255,255,255,0.1); color: #ffffff; border:none; border-radius: 6px; padding: 2px 8px; font-size: 11px; font-weight: 600; cursor: pointer; transition: background .2s; }
#miniSignOutBtn:hover { background: rgba(255,255,255,0.2); }
.categories{flex:1;overflow:auto;padding-top:6px; display:flex; flex-direction:column; gap:4px;}
.category{ display:flex;align-items:center;gap:8px;padding:10px;border-radius:10px; cursor:pointer;user-select:none;transition: background .2s, opacity .2s, transform .2s; position:relative; box-shadow:0 5px 15px rgba(0,0,0,0.2); background:rgba(255,255,255,0.1); }
.category:hover{background:rgba(255,255,255,0.2); transform:translateY(-2px);}
.category.active{background:rgba(255,255,255,0.3);}
.cat-icon{width:36px;height:36px;border-radius:8px; background:rgba(255,255,255,0.2); display:flex;align-items:center;justify-content:center;font-weight:700; flex-shrink: 0; color:#ffffff;}
.cat-name{font-weight:600;flex:1;pointer-events: none; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; color:#ffffff;}
.main{ display:flex;flex-direction:column;height:100%;overflow:hidden; background:var(--card); padding:24px; border-radius:20px 0 0 20px; margin:20px 0; box-shadow:0 20px 60px rgba(0, 0, 0, 0.3); color:#333; }
.header{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;}
.header-title{font-size:20px;font-weight:800; color:#333;}
#viewControls { display: none; flex-direction: row; gap: 8px; }
#viewControls button { padding: 6px 12px; font-size: 14px; border-radius:20px; }
.view-btn.active { background: var(--accent); color: white; }
.bookmark-list{flex:1;overflow:auto;display:flex;flex-direction:column;gap:10px;}
.card{ display:flex;align-items:center;gap:12px;background:linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding:15px;border-radius:20px;border:1px solid rgba(255,255,255,0.1); cursor:grab;transition:transform .1s, box-shadow .2s; box-shadow:0 5px 15px rgba(0,0,0,0.1); color:#ffffff; }
.card .fav{width:46px;height:46px;border-radius:10px;display:flex;align-items:center;justify-content:center;font-weight:700; overflow:hidden; flex-shrink: 0; background:rgba(255,255,255,0.2);}
.card .meta{flex:1;min-width:0;}
.card .meta .title{font-weight:700; color:#ffffff;}
.card .meta .url{font-size:12px;color:var(--muted);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
.card .actions{display:flex;gap:6px;}
.icon-btn{width:32px;height:32px;border-radius:8px;display:grid;place-items:center; border:1px solid rgba(255,255,255,0.2);cursor:pointer; background: rgba(255,255,255,0.1); color:#ffffff; flex-shrink: 0;}
.icon-btn:hover{background:rgba(255,255,255,0.2);}
.delete-cat, .edit-cat{ display:none; }
.category:hover .delete-cat, .category:hover .edit-cat{ display:grid; }
#homeBtn { display: flex; align-items: center; justify-content: center; gap: 8px; font-weight: 600; font-size: 15px; border-radius:20px; background:rgba(255,255,255,0.1); color:#ffffff; padding:10px; }
#homeBtn svg { width: 22px; height: 22px; }
.content-grid{ display:grid; grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); gap:18px; }
.grid-tile{ background:linear-gradient(135deg, #667eea 0%, #764ba2 100%);border-radius:20px;padding:16px;text-align:center; box-shadow:0 6px 16px rgba(0,0,0,0.1); transition:transform .2s, box-shadow .2s;cursor:pointer; text-decoration: none; color: #ffffff;}
.grid-tile:hover{transform:translateY(-3px); box-shadow:0 10px 25px rgba(102, 126, 234, 0.3);}
.grid-tile img{width:48px;height:48px;border-radius:12px;margin-bottom:8px; object-fit:cover;}
.grid-tile .title{font-weight:600;font-size:14px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;width:100%; color:#ffffff;}
.modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(8,15,28,0.35);z-index:100;}
.modal.active{display:flex;}
.modal-card{ width:400px;background:var(--card);padding:20px;border-radius:20px; box-shadow:0 20px 40px rgba(0,0,0,0.15); backdrop-filter:blur(10px); color:#333; }
.form-group { margin-bottom: 12px; }
label{font-size:13px;color:#666;display:block; margin-bottom: 4px;}
input[type=text], input[type=number], textarea, select{width:100%;padding:10px;border-radius:8px;border:1px solid rgba(0,0,0,0.1);box-sizing:border-box;}
.modal-actions{display:flex;justify-content:flex-end;gap:8px;margin-top:12px;}
.btn{padding:8px 12px;border-radius:10px;background:linear-gradient(135deg, #667eea 0%, #764ba2 100%);border:none;cursor:pointer; transition:background .2s; color:#ffffff;}
.btn:hover{background:linear-gradient(135deg, #5a6fd8 0%, #6a4190 100%);}
.widget-iframe { width: 100%; border: none; border-radius: 16px; box-shadow: 0 8px 25px rgba(0,0,0,0.2); }
.weather-iframe { height: 280px; margin-bottom: 20px; }
.radio-iframe { height: 180px; }
</style>
</head>
<body>
<div class="app">
  <aside class="sidebar" id="sidebar">
    <div id="versionInfo">v1.9</div>
    <div class="brand">
      <div class="logo" id="userLogo">Y</div>
      <div>
        <h1 id="sidebarTitle">My Bookmarks</h1>
        <div id="sidebarSubtitleContainer" style="display: none;">
            <span id="sidebarSubtitle"></span>
            <button id="miniSignOutBtn">Sign Out</button>
        </div>
      </div>
    </div>
    <button class="btn" id="loginBtn">Sign in with Google</button>
    <hr style="border:none; border-top:1px solid rgba(255,255,255,0.2); margin:12px 0;">
    <button class="btn" id="homeBtn">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M10,20V14H14V20H19V12H22L12,3L2,12H5V20H10Z"></path></svg>
        Home
    </button>
    <button class="btn" id="addCategoryBtn" style="display:none;">+ Add Category</button>
    <div class="categories" id="categories"></div>

    <!-- Radyo Widget (iframe ile çekiliyor) -->
    <iframe src="radiowidget.html" class="widget-iframe radio-iframe" title="Radyo"></iframe>
  </aside>

  <main class="main" id="main">
    <div class="header">
      <div class="header-title" id="pageTitle">Home</div>
      <div id="viewControls">
        <button class="btn view-btn active" id="listViewBtn">List</button>
        <button class="btn view-btn" id="cardViewBtn">Card</button>
      </div>
    </div>
    <div id="contentArea"></div>
  </main>
</div>

<!-- Modallar aynı kalıyor -->
<div class="modal" id="modal">...</div>
<div class="modal" id="modalCategory">...</div>
<div class="modal" id="modalCategoryEdit">...</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getFirestore, doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";
import { getAuth, GoogleAuthProvider, signInWithPopup, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";

const firebaseConfig = {
    apiKey: "AIzaSyBZ5oi1Vb-cNFQIk04rKMDwLJWVx06DfmI",
    authDomain: "my-g-bookmarks.firebaseapp.com",
    projectId: "my-g-bookmarks",
    storageBucket: "my-g-bookmarks.firebasestorage.app",
    messagingSenderId: "702837130313",
    appId: "1:702837130313:web:bb7e64d33a772ed3d1eb98",
    measurementId: "G-WZVPMS2XY4"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const auth = getAuth();

let BOOKMARKS = [];
let currentUser = null;
let currentView = 'home';
let viewMode = 'list';
let editingState = { bookmarkId: null, categoryId: null };
const $ = (s) => document.querySelector(s);

function sortCategories() { BOOKMARKS.sort((a, b) => (a.order ?? 999) - (b.order ?? 999)); }

function renderApp() {
    sortCategories();
    renderCategories();
    if (currentView === 'home') renderHome();
    else renderCategory(currentView);
}

async function handleDataChange() { await saveBookmarks(); renderApp(); }

// Auth ve diğer tüm kodlar tamamen aynı kalıyor...
// (Yer imleri mantığı, kaydetme, render vb. hiç değişmedi)
onAuthStateChanged(auth, async user => {
    currentUser = user;
    if (user) {
        $('#sidebarTitle').textContent = user.displayName || 'Bookmarks';
        $('#sidebarSubtitle').textContent = user.email;
        $('#sidebarSubtitleContainer').style.display = 'flex';
        $('#userLogo').innerHTML = user.photoURL ? `<img src="${user.photoURL}" alt="User">` : (user.displayName || 'U').charAt(0);
        $('#loginBtn').style.display = 'none';
        $('#addCategoryBtn').style.display = 'block';
       
        const snap = await getDoc(doc(db, "bookmarks", currentUser.uid));
        BOOKMARKS = (snap.exists() ? snap.data().categories : []) || [];
        BOOKMARKS.forEach((cat, i) => {
            if (cat.order === undefined) cat.order = i;
            cat.items = (cat.items || []).map(item => ({...item, showHome: !!item.showHome}));
        });
        currentView = 'home';
        renderApp();
    } else {
        $('#sidebarTitle').textContent = 'My Bookmarks';
        $('#sidebarSubtitleContainer').style.display = 'none';
        $('#userLogo').textContent = 'Y';
        $('#loginBtn').style.display = 'block';
        $('#addCategoryBtn').style.display = 'none';
        BOOKMARKS = [];
        currentView = 'home';
        renderApp();
        $('#contentArea').innerHTML = "<div style='padding:20px; color:#666'>Please sign in.</div>";
    }
});

async function saveBookmarks() {
    if (!currentUser) return;
    const cleanedBookmarks = BOOKMARKS.map(cat => {
        const c = { ...cat };
        c.items = (cat.items || []).map(i => {
            const item = {};
            for (const k in i) if (i[k] !== undefined) item[k] = i[k];
            return item;
        });
        for (const k in c) if (c[k] === undefined) delete c[k];
        return c;
    });
    await setDoc(doc(db, "bookmarks", currentUser.uid), { categories: cleanedBookmarks });
}

function createFaviconHTML(item, def) {
    if (item.icon) return `<img src="${item.icon}" alt="" onerror="this.parentElement.innerHTML='${def}'">`;
    let h = '';
    try { h = new URL(item.url).hostname; } catch {}
    if (h) {
        const p = `https://www.google.com/s2/favicons?domain=${h}&sz=64`;
        const f = `https://t1.gstatic.com/faviconV2?client=SOCIAL&type=FAVICON&fallback_opts=TYPE,SIZE,URL&url=http://${h}&size=64`;
        return `<img src="${p}" alt="" onerror="this.onerror=null;this.src='${f}';">`;
    }
    return def;
}

function renderCategories() {
    const el = $('#categories');
    el.innerHTML = '';
    BOOKMARKS.forEach(cat => {
        const div = document.createElement('div');
        div.className = 'category' + (cat.id === currentView ? ' active' : '');
        div.dataset.id = cat.id;
        div.innerHTML = `<div class="cat-icon">${cat.title.charAt(0).toUpperCase()}</div><div class="cat-name">${cat.title}</div><button class="icon-btn edit-cat">Edit</button><button class="icon-btn delete-cat">Delete</button>`;
        el.appendChild(div);
    });
}

function renderHome() {
    $('#pageTitle').textContent = 'Home';
    $('#viewControls').style.display = 'none';
    const homeItems = BOOKMARKS.flatMap(c => (c.items || []).filter(i => i.showHome));
    const area = $('#contentArea');
    area.innerHTML = `
        <div style="display:flex;flex-direction:column;gap:24px;">
            <div>
                <h2 style="font-size:18px;font-weight:700;margin-bottom:12px;color:#333;">Favori Bookmarklar</h2>
                ${homeItems.length === 0 ? '<div style="padding:20px;color:#666">Ana sayfaya eklenmiş yer imi yok.</div>' : 
                `<div class="content-grid">
                    ${homeItems.map(item => `
                        <a href="${item.url}" target="_blank" class="grid-tile">
                            ${createFaviconHTML(item, item.title.charAt(0).toUpperCase())}
                            <div class="title">${item.title}</div>
                        </a>`).join('')}
                </div>`}
            </div>

            <!-- Hava Durumu Widget (iframe ile çekiliyor) -->
            <div>
                <h2 style="font-size:18px;font-weight:700;margin-bottom:12px;color:#333;">Ankara Hava Durumu</h2>
                <iframe src="weatherwidget.html" class="widget-iframe weather-iframe" title="Hava Durumu"></iframe>
            </div>
        </div>`;
}

function renderCategory(id) {
    const cat = BOOKMARKS.find(c => c.id === id);
    if (!cat) { currentView = 'home'; renderApp(); return; }
    $('#pageTitle').textContent = cat.title;
    $('#viewControls').style.display = 'flex';
    $('#listViewBtn').classList.toggle('active', viewMode === 'list');
    $('#cardViewBtn').classList.toggle('active', viewMode === 'card');
    const area = $('#contentArea');
    area.innerHTML = '';
    const items = cat.items || [];
    const container = document.createElement('div');
    container.className = viewMode === 'list' ? 'bookmark-list' : 'content-grid';
    items.forEach(item => {
        const el = document.createElement(viewMode === 'list' ? 'div' : 'a');
        el.className = viewMode === 'list' ? 'card' : 'grid-tile';
        if (viewMode === 'list') {
            el.dataset.id = item.id; el.dataset.categoryId = cat.id;
            const icon = createFaviconHTML(item, item.title.charAt(0).toUpperCase());
            el.innerHTML = `
                <a href="${item.url}" target="_blank" class="fav" style="background:rgba(255,255,255,0.2);text-decoration:none;display:flex;align-items:center;justify-content:center;">${icon}</a>
                <div class="meta"><a href="${item.url}" target="_blank" style="text-decoration:none;color:inherit;"><div class="title">${item.title}</div></a><div class="url">${item.url}</div></div>
                <div class="actions"><button class="icon-btn edit-btn">Edit</button><button class="icon-btn delete-btn">Delete</button></div>`;
        } else {
            el.href = item.url; el.target = '_blank';
            el.innerHTML = `${createFaviconHTML(item, item.title.charAt(0).toUpperCase())}<div class="title">${item.title}</div>`;
        }
        container.appendChild(el);
    });
    if (items.length === 0) container.innerHTML = '<div style="padding:20px;color:#666">Bu kategori boş.</div>';
    area.appendChild(container);
    const btn = document.createElement('button');
    btn.textContent = '+ Add Bookmark'; btn.className = 'btn'; btn.style.marginTop = '20px';
    area.appendChild(btn);
}

// Tüm modal, kaydetme, düzenleme, kategori işlemleri tamamen aynı kalıyor...
// (Kısaltmak için aynı kodları buraya tekrar yapıştırmadım ama orijinal dosyadaki gibi hepsi duruyor)

$('#loginBtn').onclick = () => signInWithPopup(auth, new GoogleAuthProvider());
$('#miniSignOutBtn').onclick = () => signOut(auth);
$('#homeBtn').onclick = () => { currentView = 'home'; renderApp(); };
$('#addCategoryBtn').onclick = () => { $('#cTitle').value = ''; $('#modalCategory').classList.add('active'); };
$('#listViewBtn').onclick = () => { viewMode = 'list'; renderApp(); };
$('#cardViewBtn').onclick = () => { viewMode = 'card'; renderApp(); };

// Kategoriler ve içerik tıklama olayları aynı...
$('#categories').addEventListener('click', e => { /* aynı kod */ });
$('#contentArea').addEventListener('click', e => { /* aynı kod */ });

[$('#cancelModal'), $('#cancelCategory'), $('#cancelCategoryEdit')].forEach(b => b.onclick = () => b.closest('.modal').classList.remove('active'));
document.addEventListener('keydown', e => { if (e.key === 'Escape') document.querySelectorAll('.modal').forEach(m => m.classList.remove('active')); });

renderApp();
</script>
</body>
</html>
