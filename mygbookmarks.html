<!doctype html>
<html lang="tr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>My Bookmarks v2.1</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
<style>
:root{ --bg:linear-gradient(135deg, #667eea 0%, #764ba2 100%); --card:rgba(255, 255, 255, 0.95); --muted:#e0e6ff; --accent:#667eea; font-family:'Inter',sans-serif; }
html,body{margin:0;height:100%;background:var(--bg);color:#ffffff;}
.app{display:grid;grid-template-columns:280px 1fr;height:100vh;}
.sidebar{ background:linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-right:1px solid rgba(255,255,255,0.1); padding:20px; display:flex;flex-direction:column;gap:16px; color:#ffffff; }
#versionInfo {
    background: rgba(255, 255, 255, 0.2); color: #ffffff; padding: 3px 8px;
    border-radius: 8px; font-size: 12px; font-weight: 600;
    align-self: flex-start;
    margin-bottom: 8px;
}
.brand{display:flex;align-items:center;gap:12px;}
.logo{ width:48px;height:48px;border-radius:50%; background:conic-gradient(from 180deg,#ffffff,#e0e6ff,#a8e6cf,#ffd93d,#ffffff); display:flex;align-items:center;justify-content:center; font-weight:800;color:#667eea;overflow:hidden; }
.logo img{width:100%;height:100%;border-radius:50%;object-fit:cover;}
h1{font-size:17px;margin:0;color:#ffffff;}
#sidebarSubtitleContainer{ display: flex; align-items: center; justify-content: space-between; font-size: 12px; color: var(--muted); margin-top: 4px; }
#miniSignOutBtn { background: rgba(255,255,255,0.1); color: #ffffff; border:none; border-radius: 6px; padding: 2px 8px; font-size: 11px; font-weight: 600; cursor: pointer; transition: background .2s; }
#miniSignOutBtn:hover { background: rgba(255,255,255,0.2); }
.categories{flex:1;overflow:auto;padding-top:6px; display:flex; flex-direction:column; gap:4px;}
.category{ display:flex;align-items:center;gap:8px;padding:10px;border-radius:10px; cursor:pointer;user-select:none;transition: background .2s, opacity .2s, transform .2s; position:relative; box-shadow:0 5px 15px rgba(0,0,0,0.2); background:rgba(255,255,255,0.1); }
.category.dragging{ opacity: 0.5; background: rgba(255,255,255,0.2); }
.category:hover{background:rgba(255,255,255,0.2); transform:translateY(-2px);}
.category.active{background:rgba(255,255,255,0.3); transform:translateY(-2px);}
.cat-icon{width:36px;height:36px;border-radius:8px; background:rgba(255,255,255,0.2); display:flex;align-items:center;justify-content:center;font-weight:700; flex-shrink: 0; color:#ffffff;}
.cat-name{font-weight:600;flex:1;pointer-events: none; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; color:#ffffff;}
.main{ display:flex;flex-direction:column;height:100%;overflow:hidden; background:var(--card); padding:24px; border-radius:20px 0 0 20px; margin:20px 0; box-shadow:0 20px 60px rgba(0, 0, 0, 0.3); color:#333; }
.header{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;}
.header-title{font-size:20px;font-weight:800; color:#333;}
#viewControls { display: flex; flex-direction: row; gap: 8px; }
#viewControls button { padding: 6px 12px; font-size: 14px; border-radius:20px; }
.view-btn.active { background: var(--accent); color: white; }
.icon-btn{width:32px;height:32px;border-radius:8px;display:grid;place-items:center; border:1px solid rgba(255,255,255,0.2);cursor:pointer; background: rgba(255,255,255,0.1); color:#ffffff; flex-shrink: 0;}
.icon-btn:hover{background:rgba(255,255,255,0.2);}
.delete-cat, .edit-cat{ display:none; }
.category:hover .delete-cat, .category:hover .edit-cat{ display:grid; }
#homeBtn, #settingsBtn { display: flex; align-items: center; justify-content: center; gap: 8px; font-weight: 600; font-size: 15px; border-radius:20px; background:rgba(255,255,255,0.1); color:#ffffff; }
#homeBtn svg, #settingsBtn svg { width: 22px; height: 22px; }
.content-grid{ display:grid; grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); gap:18px; }
.grid-tile{ position: relative; background:linear-gradient(135deg, #667eea 0%, #764ba2 100%);border-radius:20px;padding:16px;text-align:center; box-shadow:0 6px 16px rgba(0,0,0,0.1); transition:transform .2s, box-shadow .2s;cursor:pointer; text-decoration: none; color: #ffffff;}
.grid-tile:hover{transform:translateY(-3px); box-shadow:0 10px 25px rgba(102, 126, 234, 0.3);}
.grid-tile img{width:48px;height:48px;border-radius:12px;margin-bottom:8px; object-fit:cover;}
.grid-tile .title{font-weight:600;font-size:14px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;width:100%; color:#ffffff;}
.edit-bookmark-btn { position: absolute; top: 8px; right: 8px; display: none; z-index: 5; background: rgba(0,0,0,0.3); backdrop-filter: blur(5px); }
.grid-tile:hover .edit-bookmark-btn { display: grid; }
.modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(8,15,28,0.35);z-index:100;}
.modal.active{display:flex;}
.modal-card{ width:400px;background:var(--card);padding:20px;border-radius:20px; box-shadow:0 20px 40px rgba(0,0,0,0.15); backdrop-filter:blur(10px); color:#333; }
.form-group { margin-bottom: 12px; }
label{font-size:13px;color:#666;display:block; margin-bottom: 4px;}
input[type=text], input[type=number], textarea, select{width:100%;padding:10px;border-radius:8px;border:1px solid rgba(0,0,0,0.1);box-sizing:border-box;}
.modal-actions{display:flex;justify-content:flex-end;gap:8px;margin-top:12px;}
.btn{padding:8px 12px;border-radius:10px;background:linear-gradient(135deg, #667eea 0%, #764ba2 100%);border:1px solid rgba(0,0,0,0.05);cursor:pointer; transition:background .2s; color:#ffffff;}
.btn:hover{background:linear-gradient(135deg, #5a6fd8 0%, #6a4190 100%);}
.switch{display:flex;align-items:center;gap:8px;margin-top:12px; user-select:none;}

/* Weather Styles - Redesigned Horizontal Layout */
.widget-container {
    background: rgba(255, 255, 255, 0.95);
    border-radius: 20px;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
    max-width: 100%;
    width: 100%;
    overflow: hidden;
    backdrop-filter: blur(10px);
    display: flex;
    flex-direction: row;
    height: auto;
    min-height: 210px;
}
.widget-header {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    padding: 15px;
    color: white;
    position: relative;
    overflow: hidden;
    border-radius: 20px;
    flex: 0 0 180px;
    display: flex;
    flex-direction: column;
    justify-content: space-around;
    align-items: center;
    text-align: center;
}
.weather-animation { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; }
.rain-drop { position: absolute; width: 2px; height: 20px; background: linear-gradient(transparent, rgba(255, 255, 255, 0.6)); animation: rain-fall linear infinite; }
@keyframes rain-fall { to { transform: translateY(220px); } }
.snow-flake { position: absolute; width: 10px; height: 10px; background: white; border-radius: 50%; animation: snow-fall linear infinite; }
@keyframes snow-fall { to { transform: translateY(220px) rotate(360deg); } }
.sun-rays { position: absolute; top: 50%; left: 50%; width: 120px; height: 120px; animation: rotate 20s linear infinite; font-size: 80px; transform: translate(-50%, -50%); opacity: 0.1; }
@keyframes rotate { to { transform: translate(-50%, -50%) rotate(360deg); } }
.district-selector { position: relative; z-index: 10; width: 100%; }
.district-selector select { width: 100%; padding: 6px 12px; border: none; border-radius: 10px; font-size: 12px; background: rgba(255, 255, 255, 0.2); color: white; cursor: pointer; outline: none; }
.district-selector select option { background: #667eea; color: white; }
.current-weather {
    position: relative;
    z-index: 10;
    display: flex;
    flex-direction: column;
    align-items: center;
    margin: 8px 0;
}
.current-temp { font-size: 48px; font-weight: 800; line-height: 1; }
.weather-icon-main { font-size: 44px; margin: -5px 0; }
.weather-desc { font-size: 13px; font-weight: 600; }
.weather-details {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 8px 12px;
    position: relative;
    z-index: 10;
    width: 100%;
}
.detail-item { display: flex; align-items: center; justify-content: center; gap: 4px; font-size: 11px; }
.detail-icon { font-size: 14px; }
.api-notice { display: none; }
.widget-body { padding: 15px; flex: 1; display: flex; flex-direction: column; overflow: hidden; }
.section-title { font-size: 14px; font-weight: bold; color: #333; margin-bottom: 10px; }
.hourly-forecast { display: flex; gap: 8px; overflow-x: auto; padding: 5px 0; margin-bottom: 10px; flex: 1; }
.hourly-forecast::-webkit-scrollbar { height: 4px; }
.hourly-forecast::-webkit-scrollbar-track { background: #f1f1f1; border-radius: 10px; }
.hourly-forecast::-webkit-scrollbar-thumb { background: #667eea; border-radius: 10px; }
.hour-card { min-width: 60px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 10px; padding: 8px; text-align: center; color: white; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1); transition: transform 0.3s; flex-shrink: 0; }
.hour-card:hover { transform: translateY(-2px); }
.hour-time { font-size: 10px; margin-bottom: 2px; opacity: 0.9; }
.hour-icon { font-size: 20px; margin: 2px 0; }
.hour-temp { font-size: 14px; font-weight: bold; }
.hour-rain { font-size: 8px; margin-top: 2px; opacity: 0.8; }
.daily-forecast { display: flex; gap: 8px; overflow-x: auto; padding: 5px 0; }
.day-card { min-width: 80px; background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%); border-radius: 10px; padding: 10px; text-align: center; transition: all 0.3s; border: 1px solid transparent; flex-shrink: 0; }
.day-card:hover { border-color: #667eea; transform: translateY(-2px); box-shadow: 0 4px 12px rgba(102, 126, 234, 0.2); }
.day-name { font-weight: bold; color: #667eea; margin-bottom: 5px; font-size: 11px; }
.day-icon { font-size: 24px; margin: 5px 0; }
.day-temps { display: flex; justify-content: center; gap: 4px; font-size: 12px; color: #333; }
.temp-max { font-weight: bold; }
.temp-min { opacity: 0.6; }
.day-rain { font-size: 8px; margin-top: 3px; opacity: 0.8; }
.loading { text-align: center; padding: 10px; font-size: 12px; color: #667eea; }
.error { text-align: center; padding: 10px; color: #e74c3c; }

/* Radio Widget Styles */
#radioWidget { background: rgba(255,255,255,0.95); border-radius: 25px; padding: 20px; margin-top: 10px; box-shadow: 0 15px 40px rgba(0, 0, 0, 0.3); backdrop-filter: blur(10px); text-align: center; }
#radioScreen { background: #000; color: #00ff00; padding: 12px; border-radius: 12px; margin-bottom: 15px; font-size: 1rem; font-family: 'Courier New', monospace; min-height: 60px; display: flex; flex-direction: column; justify-content: center; box-shadow: inset 0 2px 10px rgba(0, 0, 0, 0.5); }
.station-name { font-size: 16px; font-weight: bold; margin-bottom: 2px; }
.station-freq { font-size: 12px; opacity: 0.8; }
.radio-controls { display: flex; justify-content: center; align-items: center; gap: 15px; margin-bottom: 15px; }
.radio-btn { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: #ffffff; border: none; padding: 0; border-radius: 50%; cursor: pointer; font-size: 20px; width: 50px; height: 50px; display: flex; align-items: center; justify-content: center; transition: all 0.3s; box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4); }
.radio-btn:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6); }
.radio-btn:active { transform: translateY(0); }
#playPauseBtn { width: 60px; height: 60px; font-size: 24px; background: linear-gradient(135deg, #00ff00 0%, #00cc00 100%); }
#playPauseBtn:hover { box-shadow: 0 6px 20px rgba(0, 255, 0, 0.6); }
.volume-controls { display: flex; justify-content: center; align-items: center; gap: 10px; font-size: 0.9rem; }
.volume-btn { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: #ffffff; border: none; padding: 6px 12px; border-radius: 8px; cursor: pointer; font-size: 1rem; font-weight: bold; transition: all 0.3s; box-shadow: 0 2px 10px rgba(102, 126, 234, 0.3); }
.volume-btn:hover { transform: translateY(-2px); box-shadow: 0 4px 15px rgba(102, 126, 234, 0.5); }
#volumeDisplay { font-size: 18px; font-weight: bold; color: #667eea; min-width: 50px; text-align: center; }

/* GAMES SECTION STYLES */
.games-container {
    background: rgba(255, 255, 255, 0.95);
    border-radius: 20px;
    padding: 20px;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
    margin-top: 24px;
}
.games-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 16px;
}
.games-title {
    font-size: 18px;
    font-weight: 800;
    color: #333;
}
.games-tabs {
    display: flex;
    gap: 12px;
    margin-bottom: 16px;
    border-bottom: 1px solid rgba(0,0,0,0.1);
    padding-bottom: 8px;
}
.game-tab {
    padding: 8px 16px;
    border-radius: 20px;
    font-size: 13px;
    font-weight: 600;
    cursor: pointer;
    background: rgba(102, 126, 234, 0.1);
    color: #667eea;
    border: none;
    transition: all 0.2s;
}
.game-tab.active {
    background: var(--accent);
    color: white;
}
.games-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
    gap: 16px;
}
.game-card {
    position: relative;
    border-radius: 12px;
    overflow: hidden;
    aspect-ratio: 2/3; /* Vertical Card Ratio */
    background-color: #333;
    background-size: cover;
    background-position: center;
    box-shadow: 0 4px 15px rgba(0,0,0,0.2);
    transition: transform 0.2s, box-shadow 0.2s;
    cursor: pointer;
}
.game-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 8px 25px rgba(0,0,0,0.3);
}
.game-card-overlay {
    position: absolute;
    inset: 0;
    background: linear-gradient(to bottom, rgba(0,0,0,0.7) 0%, transparent 40%, rgba(0,0,0,0.8) 100%);
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    padding: 12px;
}
.game-card-title {
    color: white;
    font-weight: 700;
    font-size: 14px;
    text-shadow: 0 2px 4px rgba(0,0,0,0.8);
    line-height: 1.2;
}
.game-card-percent {
    align-self: flex-end;
    background: rgba(102, 126, 234, 0.9);
    color: white;
    padding: 4px 8px;
    border-radius: 6px;
    font-size: 11px;
    font-weight: 800;
    box-shadow: 0 2px 8px rgba(0,0,0,0.3);
}
.game-card-percent.completed {
    background: #00b894; /* Green for completed */
}
.game-edit-btn {
    position: absolute;
    top: 8px;
    right: 8px;
    width: 28px;
    height: 28px;
    border-radius: 6px;
    background: rgba(255,255,255,0.9);
    color: #333;
    display: none;
    align-items: center;
    justify-content: center;
    font-size: 14px;
    border: none;
    cursor: pointer;
    z-index: 10;
}
.game-card:hover .game-edit-btn {
    display: flex;
}

/* Visual Improvements */
.sidebar { box-shadow: 0 10px 30px rgba(0,0,0,0.2); }
.category { box-shadow: 0 8px 25px rgba(0,0,0,0.15); border: 1px solid rgba(255,255,255,0.1); }
.category:hover { box-shadow: 0 12px 35px rgba(0,0,0,0.25); }
.main { box-shadow: 0 25px 70px rgba(0,0,0,0.35); padding: 28px; }
.grid-tile { box-shadow: 0 8px 20px rgba(0,0,0,0.15); border: 1px solid rgba(255,255,255,0.2); }
.grid-tile:hover { box-shadow: 0 15px 40px rgba(102, 126, 234, 0.4); transform: translateY(-5px); }
.btn { box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3); }
.btn:hover { box-shadow: 0 6px 20px rgba(90, 111, 216, 0.4); }
.modal-card { box-shadow: 0 25px 50px rgba(0,0,0,0.2); }
</style>
</head>
<body>
<div class="app">
  <aside class="sidebar" id="sidebar">
    <div id="versionInfo">v2.1</div>
    <div class="brand">
      <div class="logo" id="userLogo">Y</div>
      <div>
        <h1 id="sidebarTitle">My Bookmarks</h1>
        <div id="sidebarSubtitleContainer" style="display: none;">
            <span id="sidebarSubtitle"></span>
            <button id="miniSignOutBtn">Sign Out</button>
        </div>
      </div>
    </div>
    <button class="btn" id="loginBtn">Sign in with Google</button>
    <hr style="border:none; border-top:1px solid rgba(255,255,255,0.2); margin: 0;">
    <button class="btn" id="homeBtn">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M10,20V14H14V20H19V12H22L12,3L2,12H5V20H10Z"></path></svg>
        Home
    </button>
    <button class="btn" id="settingsBtn" style="display:none;">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M19.43,12.98C19.47,12.65 19.5,12.33 19.5,12C19.5,11.67 19.47,11.34 19.43,11L21.54,9.37C21.73,9.22 21.78,8.95 21.66,8.73L19.66,5.27C19.54,5.05 19.27,4.96 19.05,5.05L16.56,6.05C16.04,5.66 15.5,5.32 14.87,5.07L14.5,2.42C14.46,2.18 14.25,2 14,2H10C9.75,2 9.54,2.18 9.5,2.42L9.13,5.07C8.5,5.32 7.96,5.66 7.44,6.05L4.95,5.05C4.73,4.96 4.46,5.05 4.34,5.27L2.34,8.73C2.21,8.95 2.27,9.22 2.46,9.37L4.57,11C4.53,11.34 4.5,11.67 4.5,12C4.5,12.33 4.53,12.65 4.57,12.98L2.46,14.63C2.27,14.78 2.21,15.05 2.34,15.27L4.34,18.73C4.46,18.95 4.73,19.03 4.95,18.95L7.44,17.94C7.96,18.34 8.5,18.68 9.13,18.93L9.5,21.58C9.54,21.82 9.75,22 10,22H14C14.25,22 14.46,21.82 14.5,21.58L14.87,18.93C15.5,18.68 16.04,18.34 16.56,17.94L19.05,18.95C19.27,19.03 19.54,18.95 19.66,18.73L21.66,15.27C21.78,15.05 21.73,14.78 21.54,14.63L19.43,12.98M12,15.5A3.5,3.5 0 0,1 8.5,12A3.5,3.5 0 0,1 12,8.5A3.5,3.5 0 0,1 15.5,12A3.5,3.5 0 0,1 12,15.5Z"></path></svg>
        Settings
    </button>
    <button class="btn" id="addCategoryBtn" style="display:none;">+ Add Category</button>
    <div class="categories" id="categories"></div>

    <!-- Radio Widget -->
    <div id="radioWidget">
      <div id="radioScreen">
        <div class="station-name">Radyo - ƒ∞stasyon Se√ßin</div>
        <div class="station-freq">--.- MHz</div>
      </div>
      <div class="radio-controls">
        <button class="radio-btn" id="prevStationBtn">‚óÄ</button>
        <button class="radio-btn" id="playPauseBtn">‚ñ∂</button>
        <button class="radio-btn" id="nextStationBtn">‚ñ∂</button>
      </div>
      <div class="volume-controls">
        <button class="volume-btn" id="volumeDownBtn">‚àí</button>
        <span id="volumeDisplay">50%</span>
        <button class="volume-btn" id="volumeUpBtn">+</button>
      </div>
    </div>
  </aside>

  <main class="main" id="main">
    <div class="header">
      <div class="header-title" id="pageTitle">Home</div>
      <div id="viewControls">
        <button class="btn view-btn active" id="cardViewBtn">Card</button>
      </div>
    </div>
    <div id="contentArea"></div>
  </main>
</div>

<!-- MODALS -->
<div class="modal" id="modal">
  <div class="modal-card">
    <h3 id="modalTitle">Add/Edit Bookmark</h3>
    <div class="form-group"><label for="mTitle">Title</label><input id="mTitle" type="text"></div>
    <div class="form-group"><label for="mUrl">URL</label><input id="mUrl" type="text"></div>
    <div class="form-group"><label for="mCategory">Category</label><select id="mCategory"></select></div>
    <div class="form-group"><label for="mIcon">Icon URL (optional)</label><input id="mIcon" type="text"></div>
    <div class="switch"><input type="checkbox" id="mShowHome"><label for="mShowHome">Show on Home</label></div>
    <div class="modal-actions">
      <button class="btn" id="cancelModal">Cancel</button>
      <button class="btn" id="saveModal">Save</button>
    </div>
  </div>
</div>

<div class="modal" id="modalCategory">
  <div class="modal-card">
    <h3>Add Category</h3>
    <div class="form-group"><label for="cTitle">Category Name</label><input id="cTitle" type="text"></div>
    <div class="modal-actions">
      <button class="btn" id="cancelCategory">Cancel</button>
      <button class="btn" id="saveCategory">Save</button>
    </div>
  </div>
</div>

<div class="modal" id="modalCategoryEdit">
  <div class="modal-card">
    <h3>Edit Category</h3>
    <div class="form-group"><label for="ceTitle">Category Name</label><input id="ceTitle" type="text"></div>
    <div class="form-group"><label for="ceOrder">Order (lower number is higher)</label><input id="ceOrder" type="number" min="0"></div>
    <div class="modal-actions">
      <button class="btn" id="cancelCategoryEdit">Cancel</button>
      <button class="btn" id="saveCategoryEdit">Save</button>
    </div>
  </div>
</div>

<div class="modal" id="modalSettings">
  <div class="modal-card">
    <h3>Ayarlar</h3>
    <p style="font-size: 14px; color: #666; margin-bottom: 20px;">
        T√ºm bookmarklarƒ±nƒ±zƒ± tarayƒ±cƒ±nƒ±za aktarabileceƒüiniz bir HTML dosyasƒ± olarak dƒ±≈üa aktarƒ±n.
    </p>
    <div class="modal-actions">
      <button class="btn" id="cancelSettings">Cancel</button>
      <button class="btn" id="exportBtn">Export Bookmarks</button>
    </div>
  </div>
</div>

<!-- GAME MODAL -->
<div class="modal" id="modalGame">
  <div class="modal-card">
    <h3 id="modalGameTitle">Oyun Ekle</h3>
    <div class="form-group"><label for="gTitle">Oyun Adƒ±</label><input id="gTitle" type="text" placeholder="√ñrn: Witcher 3"></div>
    <div class="form-group"><label for="gImage">Resim Linki (Dikey poster √∂nerilir)</label><input id="gImage" type="text" placeholder="https://..."></div>
    <div class="form-group"><label for="gPercent">Tamamlanma Y√ºzdesi (0-100)</label><input id="gPercent" type="number" min="0" max="100" value="0"></div>
    <div class="modal-actions">
      <button class="btn" id="deleteGameBtn" style="background:#e74c3c; display:none; margin-right:auto;">Sil</button>
      <button class="btn" id="cancelGame">ƒ∞ptal</button>
      <button class="btn" id="saveGame">Kaydet</button>
    </div>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getFirestore, doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";
import { getAuth, GoogleAuthProvider, signInWithPopup, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";

const firebaseConfig = {
    apiKey: "AIzaSyBZ5oi1Vb-cNFQIk04rKMDwLJWVx06DfmI",
    authDomain: "my-g-bookmarks.firebaseapp.com",
    projectId: "my-g-bookmarks",
    storageBucket: "my-g-bookmarks.firebasestorage.app",
    messagingSenderId: "702837130313",
    appId: "1:702837130313:web:bb7e64d33a772ed3d1eb98",
    measurementId: "G-WZVPMS2XY4"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const auth = getAuth();

// --- STATE MANAGEMENT ---
let BOOKMARKS = [];
let GAMES = []; // Yeni oyun dizisi
let currentUser = null;
let currentView = 'home';
let viewMode = 'card';
let editingState = { bookmarkId: null, categoryId: null };
let editingGameId = null; // Oyun d√ºzenleme ID'si
let activeGameTab = 'playing'; // 'playing' or 'completed'

const $ = (selector) => document.querySelector(selector);

// --- CORE APP LOGIC ---
function sortCategories() { BOOKMARKS.sort((a, b) => (a.order ?? 999) - (b.order ?? 999)); }
function renderApp() {
    sortCategories();
    renderCategories();
    if (currentView === 'home') renderHome();
    else renderCategory(currentView);
}
async function handleDataChange() { await saveBookmarks(); renderApp(); }

// --- AUTHENTICATION ---
onAuthStateChanged(auth, async user => {
    currentUser = user;
    if (user) {
        $('#sidebarTitle').textContent = user.displayName || 'Bookmarks';
        $('#sidebarSubtitle').textContent = user.email;
        $('#sidebarSubtitleContainer').style.display = 'flex';
        $('#userLogo').innerHTML = user.photoURL ? `<img src="${user.photoURL}" alt="User">` : (user.displayName || 'U').charAt(0);
        $('#loginBtn').style.display = 'none';
        $('#addCategoryBtn').style.display = 'block';
        $('#settingsBtn').style.display = 'flex';
        
        const snap = await getDoc(doc(db, "bookmarks", currentUser.uid));
        if (snap.exists()) {
            const data = snap.data();
            BOOKMARKS = data.categories || [];
            GAMES = data.games || []; // Oyunlarƒ± √ßek
        } else {
            BOOKMARKS = [];
            GAMES = [];
        }
        
        BOOKMARKS.forEach((cat, i) => {
            if (cat.order === undefined) cat.order = i;
            cat.items = (cat.items || []).map(item => ({...item, showHome: !!item.showHome}));
        });
        currentView = 'home';
        renderApp();
    } else {
        $('#sidebarTitle').textContent = 'My Bookmarks';
        $('#sidebarSubtitleContainer').style.display = 'none';
        $('#userLogo').textContent = 'Y';
        $('#loginBtn').style.display = 'block';
        $('#addCategoryBtn').style.display = 'none';
        $('#settingsBtn').style.display = 'none';
        BOOKMARKS = [];
        GAMES = [];
        currentView = 'home';
        renderApp();
        $('#contentArea').innerHTML = "<div style='padding:20px; color:#666'>Please sign in.</div>";
    }
});

// --- DATA PERSISTENCE ---
async function saveBookmarks() {
    if (!currentUser) return;
    const cleanedBookmarks = BOOKMARKS.map(cat => {
        const cleanedCat = { ...cat };
        cleanedCat.items = (cat.items || []).map(item => {
            const cleanedItem = {};
            for (const key in item) {
                if (item[key] !== undefined) {
                    cleanedItem[key] = item[key];
                }
            }
            return cleanedItem;
        });
        return cleanedCat;
    });
       
    try {
        // Oyunlarƒ± da kaydet
        await setDoc(doc(db, "bookmarks", currentUser.uid), { 
            categories: cleanedBookmarks,
            games: GAMES 
        });
    } catch (error) {
        console.error('Error saving data: ', error);
        alert('Failed to save data: ' + error.message);
    }
}

// --- UI RENDERING & HELPERS ---
function createFaviconHTML(item, defaultChar) {
    if (item.icon) {
        return `<img src="${item.icon}" alt="" onerror="this.parentElement.innerHTML = '${defaultChar}'">`;
    }
    let hostname = '';
    try { hostname = new URL(item.url).hostname; } catch (e) {}
    if (hostname) {
        const primarySrc = `https://www.google.com/s2/favicons?domain=${hostname}&sz=64`;
        const fallbackSrc = `https://t1.gstatic.com/faviconV2?client=SOCIAL&type=FAVICON&fallback_opts=TYPE,SIZE,URL&url=http://${hostname}&size=64`;
        return `<img src="${primarySrc}" alt="" onerror="this.onerror=null; this.src='${fallbackSrc}';">`;
    }
    return defaultChar;
}

function renderCategories() {
    const categoriesEl = $('#categories');
    categoriesEl.innerHTML = '';
    BOOKMARKS.forEach(cat => {
        const el = document.createElement('div');
        el.className = 'category' + (cat.id === currentView ? ' active' : '');
        el.dataset.id = cat.id;
        el.innerHTML = `<div class="cat-icon">${cat.title.charAt(0).toUpperCase()}</div><div class="cat-name">${cat.title}</div><button class="icon-btn edit-cat">‚úèÔ∏è</button><button class="icon-btn delete-cat">üóëÔ∏è</button>`;
        categoriesEl.appendChild(el);
    });
}

function renderHome() {
    $('#pageTitle').textContent = 'Home';
    $('#viewControls').style.display = 'none';
    const homeItems = BOOKMARKS.flatMap(c => (c.items || []).filter(i => i.showHome).map(item => ({...item, categoryId: c.id })));
    const contentArea = $('#contentArea');
    contentArea.innerHTML = '';
    const homeContainer = document.createElement('div');
    homeContainer.style.cssText = "display: flex; flex-direction: column; gap: 24px;";

    // --- FAVORITES SECTION ---
    const favoritesSection = document.createElement('div');
    const favoritesHeader = document.createElement('h2');
    favoritesHeader.textContent = 'Favori Bookmarklar';
    favoritesHeader.style.cssText = "font-size: 18px; font-weight: 700; margin-bottom: 12px; color:#333;";
    favoritesSection.appendChild(favoritesHeader);
    if (homeItems.length === 0) {
        favoritesSection.innerHTML += "<div style='padding:20px; color:#666'>Ana Sayfaya eklenmi≈ü yer imi bulunmuyor.</div>";
    } else {
        const grid = document.createElement('div');
        grid.className = 'content-grid';
        homeItems.forEach(item => {
            const tile = document.createElement('a');
            tile.className = 'grid-tile';
            tile.href = item.url;
            tile.target = '_blank';
            tile.innerHTML = `
                ${createFaviconHTML(item, item.title.charAt(0).toUpperCase())}
                <div class='title'>${item.title}</div>
                <button class="icon-btn edit-bookmark-btn" data-bookmark-id="${item.id}" data-category-id="${item.categoryId}">‚úèÔ∏è</button>
            `;
            grid.appendChild(tile);
        });
        favoritesSection.appendChild(grid);
    }
    homeContainer.appendChild(favoritesSection);

    // --- WEATHER WIDGET SECTION ---
    const weatherSection = document.createElement('div');
    weatherSection.innerHTML = `
        <div class="widget-container">
            <div class="widget-header" id="header">
                <div class="weather-animation" id="weatherAnimation"></div>
                <div class="district-selector">
                    <select id="districtSelect">
                        <option value="Etimesgut">Etimesgut</option><option value="√áankaya">√áankaya</option><option value="Ke√ßi√∂ren">Ke√ßi√∂ren</option><option value="Mamak">Mamak</option><option value="Yenimahalle">Yenimahalle</option><option value="Altƒ±ndaƒü">Altƒ±ndaƒü</option><option value="Sincan">Sincan</option><option value="Pursaklar">Pursaklar</option><option value="G√∂lba≈üƒ±">G√∂lba≈üƒ±</option><option value="Polatlƒ±">Polatlƒ±</option><option value="Ankara Merkez">Ankara Merkez</option>
                    </select>
                </div>
                <div class="current-weather">
                    <div class="weather-icon-main" id="mainIcon">‚òÅÔ∏è</div>
                    <div class="current-temp" id="currentTemp">--¬∞</div>
                    <div class="weather-desc" id="weatherDesc">Y√ºkleniyor...</div>
                </div>
                <div class="weather-details" id="weatherDetails">
                    <div class="detail-item"><span class="detail-icon">üíß</span><span id="humidity">--%</span></div>
                    <div class="detail-item"><span class="detail-icon">üí®</span><span id="wind">-- km/s</span></div>
                    <div class="detail-item"><span class="detail-icon">üåßÔ∏è</span><span id="rainChance">--%</span></div>
                    <div class="detail-item"><span class="detail-icon">üå°Ô∏è</span><span id="feelsLike">--¬∞</span></div>
                </div>
            </div>
            <div class="widget-body">
                <div class="section-title">üìÖ Saatlik</div>
                <div class="hourly-forecast" id="hourlyForecast"><div class="loading">Y√ºkleniyor...</div></div>
                <div class="section-title">üìÜ G√ºnl√ºk</div>
                <div class="daily-forecast" id="dailyForecast"><div class="loading">Y√ºkleniyor...</div></div>
            </div>
        </div>
    `;
    homeContainer.appendChild(weatherSection);

    // --- GAMES SECTION (YENƒ∞ EKLENDƒ∞) ---
    const gamesSection = document.createElement('div');
    gamesSection.className = 'games-container';
    gamesSection.innerHTML = `
        <div class="games-header">
            <div class="games-title">Oyunlarƒ±m</div>
            <button class="btn" id="addGameBtn" style="font-size:12px; padding:6px 10px;">+ Oyun Ekle</button>
        </div>
        <div class="games-tabs">
            <button class="game-tab ${activeGameTab === 'playing' ? 'active' : ''}" data-tab="playing">Oynadƒ±ƒüƒ±m Oyunlar</button>
            <button class="game-tab ${activeGameTab === 'completed' ? 'active' : ''}" data-tab="completed">Bitirilen Oyunlar</button>
        </div>
        <div class="games-grid" id="gamesGrid">
            <!-- Oyun kartlarƒ± buraya gelecek -->
        </div>
    `;
    homeContainer.appendChild(gamesSection);

    contentArea.appendChild(homeContainer);
    
    // Init widgets
    setTimeout(() => { 
        initWeatherWidget(); 
        renderGames(); // Oyunlarƒ± render et
    }, 100);
}

// --- GAMES RENDER & LOGIC ---
function renderGames() {
    const grid = $('#gamesGrid');
    if (!grid) return;
    
    let filteredGames = [];
    if (activeGameTab === 'playing') {
        filteredGames = GAMES.filter(g => g.percent < 100);
    } else {
        filteredGames = GAMES.filter(g => g.percent >= 100);
    }

    grid.innerHTML = '';
    
    if (filteredGames.length === 0) {
        grid.innerHTML = `<div style="color:#888; font-size:13px; padding:10px;">Bu listede oyun yok.</div>`;
        return;
    }

    filteredGames.forEach(game => {
        const card = document.createElement('div');
        card.className = 'game-card';
        // Varsayƒ±lan gri arkaplan veya oyun resmi
        card.style.backgroundImage = `url('${game.image || ''}')`;
        card.innerHTML = `
            <button class="game-edit-btn" data-game-id="${game.id}">‚úèÔ∏è</button>
            <div class="game-card-overlay">
                <div class="game-card-title">${game.title}</div>
                <div class="game-card-percent ${game.percent >= 100 ? 'completed' : ''}">${game.percent}%</div>
            </div>
        `;
        grid.appendChild(card);
    });

    // Event listener for tab buttons within the rendered HTML
    document.querySelectorAll('.game-tab').forEach(btn => {
        btn.onclick = () => {
            activeGameTab = btn.dataset.tab;
            renderHome(); // Re-render whole home to reflect state
        };
    });

    // Event listener for game edit buttons
    document.querySelectorAll('.game-edit-btn').forEach(btn => {
        btn.onclick = (e) => {
            e.stopPropagation();
            openGameModal(btn.dataset.game-id);
        };
    });
    
    // Event listener for Add Game
    const addGameBtn = $('#addGameBtn');
    if(addGameBtn) addGameBtn.onclick = () => openGameModal();
}

function openGameModal(gameId = null) {
    editingGameId = gameId;
    const modal = $('#modalGame');
    const deleteBtn = $('#deleteGameBtn');
    
    if (gameId) {
        const game = GAMES.find(g => g.id === gameId);
        if (game) {
            $('#modalGameTitle').textContent = "Oyun D√ºzenle";
            $('#gTitle').value = game.title;
            $('#gImage').value = game.image;
            $('#gPercent').value = game.percent;
            deleteBtn.style.display = 'block';
        }
    } else {
        $('#modalGameTitle').textContent = "Oyun Ekle";
        $('#gTitle').value = '';
        $('#gImage').value = '';
        $('#gPercent').value = 0;
        deleteBtn.style.display = 'none';
    }
    
    modal.classList.add('active');
}

$('#saveGame').onclick = async () => {
    const title = $('#gTitle').value.trim();
    const image = $('#gImage').value.trim();
    let percent = parseInt($('#gPercent').value);
    
    if (!title) return alert("Oyun adƒ± gerekli.");
    if (isNaN(percent) || percent < 0) percent = 0;
    if (percent > 100) percent = 100;

    if (editingGameId) {
        const game = GAMES.find(g => g.id === editingGameId);
        if (game) {
            game.title = title;
            game.image = image;
            game.percent = percent;
        }
    } else {
        GAMES.push({
            id: 'g_' + Date.now(),
            title,
            image,
            percent
        });
    }

    $('#modalGame').classList.remove('active');
    await handleDataChange();
};

$('#deleteGameBtn').onclick = async () => {
    if (!editingGameId) return;
    if (!confirm("Bu oyunu silmek istediƒüine emin misin?")) return;
    
    GAMES = GAMES.filter(g => g.id !== editingGameId);
    $('#modalGame').classList.remove('active');
    await handleDataChange();
};

$('#cancelGame').onclick = () => $('#modalGame').classList.remove('active');

function renderCategory(catId) {
    const cat = BOOKMARKS.find(c => c.id === catId);
    if (!cat) { currentView = 'home'; renderApp(); return; }
    $('#pageTitle').textContent = cat.title;
    $('#viewControls').style.display = 'flex';
    $('#cardViewBtn').classList.add('active');
    const contentArea = $('#contentArea');
    contentArea.innerHTML = '';
    const items = cat.items || [];
    const container = document.createElement('div');
    if (items.length > 0) {
        container.className = 'content-grid';
        items.forEach(item => {
            const el = document.createElement('a');
            el.className = 'grid-tile';
            el.href = item.url;
            el.target = '_blank';
            el.innerHTML = `
                ${createFaviconHTML(item, item.title.charAt(0).toUpperCase())}
                <div class='title'>${item.title}</div>
                <button class="icon-btn edit-bookmark-btn" data-bookmark-id="${item.id}" data-category-id="${cat.id}">‚úèÔ∏è</button>
            `;
            container.appendChild(el);
        });
    } else {
        container.innerHTML = `<div style='padding:20px; color:#666'>This category is empty.</div>`;
    }
    contentArea.appendChild(container);
    const addBtn = document.createElement('button');
    addBtn.textContent = '+ Add Bookmark';
    addBtn.className = 'btn';
    addBtn.style.marginTop = '20px';
    contentArea.appendChild(addBtn);
}

// --- MODAL & DATA MANIPULATION ---
function findBookmark(bookmarkId) {
    for (const category of BOOKMARKS) {
        const bookmark = (category.items || []).find(item => item.id === bookmarkId);
        if (bookmark) return { bookmark, category };
    }
    return { bookmark: null, category: null };
}

function populateCategorySelect(selectedId = null) {
    const select = $('#mCategory');
    select.innerHTML = '';
    BOOKMARKS.forEach(cat => {
        select.innerHTML += `<option value="${cat.id}" ${cat.id === selectedId ? 'selected' : ''}>${cat.title}</option>`;
    });
}

function openModalForEdit(bookmarkId, categoryId) {
    const { bookmark } = findBookmark(bookmarkId);
    if (!bookmark) return;
    editingState = { bookmarkId, categoryId };
    $('#modalTitle').textContent = "Edit Bookmark";
    $('#mTitle').value = bookmark.title;
    $('#mUrl').value = bookmark.url;
    $('#mIcon').value = bookmark.icon || '';
    $('#mShowHome').checked = !!bookmark.showHome;
    populateCategorySelect(categoryId);
    $('#modal').classList.add('active');
}

function openModalForAdd() {
    if (currentView === 'home') { alert("Please select a category first."); return; }
    editingState = { bookmarkId: null, categoryId: currentView };
    $('#modalTitle').textContent = "Add Bookmark";
    $('#mTitle').value = ''; $('#mUrl').value = ''; $('#mIcon').value = ''; $('#mShowHome').checked = false;
    populateCategorySelect(currentView);
    $('#modal').classList.add('active');
}

$('#saveModal').onclick = async () => {
    const title = $('#mTitle').value.trim();
    let url = $('#mUrl').value.trim();
    const newCatId = $('#mCategory').value;
    if (!title || !url || !newCatId) return alert("Title, URL, and Category are required.");
    if (!url.match(/^https?:\/\//i)) url = 'https://' + url;
    const bookmarkData = { title, url, icon: $('#mIcon').value.trim() || undefined, showHome: !!$('#mShowHome').checked };
    const newCat = BOOKMARKS.find(c => c.id === newCatId);
    if (!newCat) return alert("Invalid category.");
    if (editingState.bookmarkId) {
        const { bookmark, category } = findBookmark(editingState.bookmarkId);
        if (bookmark) {
            Object.assign(bookmark, bookmarkData);
            if (newCatId !== editingState.categoryId) {
                category.items = (category.items || []).filter(i => i.id !== editingState.bookmarkId);
                newCat.items = newCat.items || []; newCat.items.push(bookmark);
            }
        }
    } else {
        newCat.items = newCat.items || []; newCat.items.push({ id: 'b_' + Date.now(), ...bookmarkData });
    }
    currentView = newCatId;
    $('#modal').classList.remove('active');
    await handleDataChange();
};

function openCategoryEditModal(catId) {
    const cat = BOOKMARKS.find(c => c.id === catId);
    if (!cat) return;
    editingState.categoryId = catId;
    $('#ceTitle').value = cat.title;
    $('#ceOrder').value = cat.order ?? '';
    $('#modalCategoryEdit').classList.add('active');
}

$('#saveCategoryEdit').onclick = () => {
    const title = $('#ceTitle').value.trim();
    const order = parseInt($('#ceOrder').value);
    if (!title) return alert("Category name is required.");
    const catId = editingState.categoryId;
    const cat = BOOKMARKS.find(c => c.id === catId);
    if (cat) {
        if (BOOKMARKS.some(c => c.id !== catId && c.title.toLowerCase() === title.toLowerCase())) {
            return alert(`Category "${title}" already exists.`);
        }
        cat.title = title;
        cat.order = isNaN(order) ? 999 : order;
    }
    $('#modalCategoryEdit').classList.remove('active');
    handleDataChange();
};

$('#saveCategory').onclick = () => {
    const title = $('#cTitle').value.trim();
    if (!title) return;
    if (BOOKMARKS.some(c => c.title.toLowerCase() === title.toLowerCase())) return alert(`Category "${title}" already exists.`);
    const minOrder = BOOKMARKS.length > 0 ? Math.min(...BOOKMARKS.map(c => c.order ?? 0)) : 0;
    BOOKMARKS.unshift({ id: 'cat_' + Date.now(), title, order: minOrder - 1, items: [] });
    $('#modalCategory').classList.remove('active');
    handleDataChange();
};

// --- EXPORT FUNCTIONALITY ---
function exportBookmarksToHtml() {
    let html = `<!DOCTYPE NETSCAPE-Bookmark-file-1>
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=UTF-8">
<TITLE>Bookmarks</TITLE>
<H1>Bookmarks</H1>
<DL><p>\n`;
    BOOKMARKS.forEach(category => {
        html += `    <DT><H3>${category.title}</H3>\n    <DL><p>\n`;
        (category.items || []).forEach(item => {
            html += `        <DT><A HREF="${item.url}">${item.title}</A>\n`;
        });
        html += `    </DL><p>\n`;
    });
    html += `</DL><p>\n`;
    const blob = new Blob([html], { type: 'text/html' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'bookmarks_export.html';
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
}

// --- EVENT LISTENERS ---
$('#loginBtn').onclick = () => signInWithPopup(auth, new GoogleAuthProvider()).catch(e => console.error("Sign in error", e));
$('#miniSignOutBtn').onclick = () => signOut(auth);
$('#homeBtn').onclick = () => { currentView = 'home'; renderApp(); };
$('#settingsBtn').onclick = () => { $('#modalSettings').classList.add('active'); };
$('#exportBtn').onclick = () => { exportBookmarksToHtml(); };
$('#addCategoryBtn').onclick = () => { $('#cTitle').value = ''; $('#modalCategory').classList.add('active'); };
$('#cardViewBtn').onclick = () => { viewMode = 'card'; renderApp(); };

$('#categories').addEventListener('click', e => {
    const categoryEl = e.target.closest('.category');
    if (!categoryEl) return;
    const catId = categoryEl.dataset.id;
    if (e.target.closest('.edit-cat')) openCategoryEditModal(catId);
    else if (e.target.closest('.delete-cat')) {
        if (!confirm("Are you sure? Bookmarks will be lost forever.")) return; // Simplified deletion
        BOOKMARKS = BOOKMARKS.filter(c => c.id !== catId);
        if (currentView === catId) currentView = 'home';
        handleDataChange();
    } else {
        currentView = catId; renderApp();
    }
});

$('#contentArea').addEventListener('click', e => {
    const addBtn = e.target.closest('.btn');
    // Eƒüer tƒ±klanan Add Game butonu deƒüilse (ona ayrƒ± listener atadƒ±k) ve bookmark ekle ise:
    if (addBtn && addBtn.textContent.includes('+ Add Bookmark') && !addBtn.id.includes('addGameBtn')) {
        openModalForAdd();
        return;
    }
    const editBtn = e.target.closest('.edit-bookmark-btn');
    if (editBtn) {
        e.preventDefault(); e.stopPropagation(); // Prevent link navigation
        const bookmarkId = editBtn.dataset.bookmarkId;
        const categoryId = editBtn.dataset.categoryId;
        openModalForEdit(bookmarkId, categoryId);
        return;
    }
});

// Close Modals
[$('#cancelModal'), $('#cancelCategory'), $('#cancelCategoryEdit'), $('#cancelSettings')].forEach(btn => btn.onclick = () => btn.closest('.modal').classList.remove('active'));
document.addEventListener('keydown', e => { 
    if (e.key === 'Escape') {
        [$('#modal'), $('#modalCategory'), $('#modalCategoryEdit'), $('#modalSettings'), $('#modalGame')].forEach(m => m.classList.remove('active')); 
    }
});

// --- RADIO WIDGET JS ---
const stations = [
    { name: "Max FM", frequency: 95.8, url: "https://maxfm.radyotvonline.net/stream/164/" },
    { name: "Radyo ODT√ú", frequency: 103.1, url: "https://stream.radyoodtu.com.tr/canli" },
    { name: "Radyo ƒ∞lef", frequency: 91.0, url: "http://radyo.cc.ankara.edu.tr:8089/stream/1" },
    { name: "Groove Salad", frequency: "Online", url: "https://ice5.somafm.com/groovesalad-128-mp3" },
    { name: "Space Station Soma", frequency: "Online", url: "https://ice5.somafm.com/spacestation-128-mp3" },
    { name: "Lush", frequency: "Online", url: "https://ice5.somafm.com/lush-128-mp3" },
    { name: "Drone Zone", frequency: "Online", url: "https://ice5.somafm.com/dronezone-128-mp3" },
];
let currentStationIndex = 0; let isPlaying = false; let volume = 50; const audio = new Audio();
function updateRadioScreen() {
    const station = stations[currentStationIndex];
    $('#radioScreen').innerHTML = `<div class="station-name">${station.name}</div><div class="station-freq">${typeof station.frequency === 'number' ? `${station.frequency} MHz` : station.frequency}</div>`;
}
function loadAndPlay() {
    audio.src = stations[currentStationIndex].url;
    audio.load();
    if (isPlaying) { audio.play().catch(err => console.error("Audio playback failed:", err)); }
}
function changeStation(dir) {
    currentStationIndex = (currentStationIndex + (dir === "prev" ? -1 : 1) + stations.length) % stations.length;
    updateRadioScreen();
    loadAndPlay();
}
function togglePlayPause() {
    isPlaying = !isPlaying;
    $('#playPauseBtn').textContent = isPlaying ? '‚è∏' : '‚ñ∂';
    if (isPlaying) { loadAndPlay(); } else { audio.pause(); }
}
function changeVolume(dir) {
    volume = Math.max(0, Math.min(100, volume + (dir === "up" ? 10 : -10)));
    audio.volume = volume / 100;
    $('#volumeDisplay').textContent = `${volume}%`;
}
$('#prevStationBtn').addEventListener('click', () => changeStation("prev"));
$('#nextStationBtn').addEventListener('click', () => changeStation("next"));
$('#playPauseBtn').addEventListener('click', togglePlayPause);
$('#volumeDownBtn').addEventListener('click', () => changeVolume("down"));
$('#volumeUpBtn').addEventListener('click', () => changeVolume("up"));
audio.volume = volume / 100; updateRadioScreen();

// --- WEATHER FUNCTIONS ---
const API_KEY = 'cd6435a221fb4a71881124700252110';
const BASE_URL = 'https://api.weatherapi.com/v1';

function getWeatherIcon(code, isDay) {
    const icons = { 1000: isDay ? '‚òÄÔ∏è' : 'üåô', 1003: '‚õÖ', 1006: '‚òÅÔ∏è', 1009: '‚òÅÔ∏è', 1030: 'üå´Ô∏è', 1063: 'üå¶Ô∏è', 1066: 'üå®Ô∏è', 1180: 'üåßÔ∏è', 1183: 'üåßÔ∏è', 1186: 'üåßÔ∏è', 1189: 'üåßÔ∏è', 1192: '‚õàÔ∏è', 1195: '‚õàÔ∏è', 1210: '‚ùÑÔ∏è', 1213: '‚ùÑÔ∏è', 1216: '‚ùÑÔ∏è', 1219: '‚ùÑÔ∏è', 1222: 'üå®Ô∏è', 1225: 'üå®Ô∏è', 1240: 'üå¶Ô∏è', 1243: '‚õàÔ∏è', 1246: '‚õàÔ∏è', 1273: '‚õàÔ∏è', 1276: '‚õàÔ∏è' };
    return icons[code] || '‚òÅÔ∏è';
}
function createWeatherAnimation(code, el) {
    el.innerHTML = '';
    if (code >= 1180 && code <= 1246) { for (let i = 0; i < 30; i++) { const d = document.createElement('div'); d.className = 'rain-drop'; d.style.left = `${Math.random()*100}%`; d.style.animationDuration = `${Math.random()*0.5+0.5}s`; d.style.animationDelay = `${Math.random()*2}s`; el.appendChild(d); } }
    else if (code >= 1210 && code <= 1225) { for (let i = 0; i < 20; i++) { const f = document.createElement('div'); f.className = 'snow-flake'; f.style.left = `${Math.random()*100}%`; f.style.animationDuration = `${Math.random()*3+2}s`; f.style.animationDelay = `${Math.random()*2}s`; el.appendChild(f); } }
    else if (code === 1000) { const r = document.createElement('div'); r.className = 'sun-rays'; r.innerHTML = '‚òÄÔ∏è'; el.appendChild(r); }
}
async function fetchWeatherData(district) {
    try {
        const response = await fetch(`${BASE_URL}/forecast.json?key=${API_KEY}&q=${encodeURIComponent(district+', Ankara, Turkey')}&days=3&lang=tr`);
        if (!response.ok) throw new Error('Weather data fetch failed');
        return await response.json();
    } catch (error) {
        console.error('API Error:', error); return null;
    }
}
function updateWeather(data) {
    if (!data) return;
    const current = data.current; const forecast = data.forecast.forecastday;
    $('#currentTemp').textContent = `${Math.round(current.temp_c)}¬∞`;
    $('#weatherDesc').textContent = current.condition.text;
    $('#mainIcon').textContent = getWeatherIcon(current.condition.code, current.is_day);
    $('#humidity').textContent = `${current.humidity}%`;
    $('#wind').textContent = `${current.wind_kph.toFixed(1)} km/s`;
    $('#rainChance').textContent = `${forecast[0].day.daily_chance_of_rain || 0}%`;
    $('#feelsLike').textContent = `${Math.round(current.feelslike_c)}¬∞`;
    createWeatherAnimation(current.condition.code, $('#weatherAnimation'));
    const allHours = forecast.flatMap(day => day.hour);
    const now = new Date();
    const next12Hours = allHours.filter(h => new Date(h.time_epoch * 1000) > now).slice(0, 12);
    $('#hourlyForecast').innerHTML = next12Hours.map(h => `<div class="hour-card"><div class="hour-time">${new Date(h.time).getHours()}:00</div><div class="hour-icon">${getWeatherIcon(h.condition.code, h.is_day)}</div><div class="hour-temp">${Math.round(h.temp_c)}¬∞</div><div class="hour-rain">üíß ${h.chance_of_rain}%</div></div>`).join('');
    const days = ['Paz', 'Pzt', 'Sal', '√áar', 'Per', 'Cum', 'Cmt'];
    $('#dailyForecast').innerHTML = forecast.map((day, i) => `<div class="day-card"><div class="day-name">${i === 0 ? 'Bug√ºn' : days[new Date(day.date).getDay()]}</div><div class="day-icon">${getWeatherIcon(day.day.condition.code, 1)}</div><div class="day-temps"><span class="temp-max">${Math.round(day.day.maxtemp_c)}¬∞</span><span class="temp-min">${Math.round(day.day.mintemp_c)}¬∞</span></div><div class="day-rain">üíß ${day.day.daily_chance_of_rain}%</div></div>`).join('');
}
async function initWeatherWidget() {
    const hourlyDiv = $('#hourlyForecast');
    const dailyDiv = $('#dailyForecast');
    if (hourlyDiv) hourlyDiv.innerHTML = '<div class="loading">Y√ºkleniyor...</div>';
    if (dailyDiv) dailyDiv.innerHTML = '<div class="loading">Y√ºkleniyor...</div>';
    const data = await fetchWeatherData('Etimesgut');
    if (data) { updateWeather(data); }
    const districtSelect = $('#districtSelect');
    if (districtSelect) {
        districtSelect.addEventListener('change', async (e) => {
            if (hourlyDiv) hourlyDiv.innerHTML = '<div class="loading">Y√ºkleniyor...</div>';
            if (dailyDiv) dailyDiv.innerHTML = '<div class="loading">Y√ºkleniyor...</div>';
            const data = await fetchWeatherData(e.target.value);
            if (data) { updateWeather(data); }
        });
    }
}
renderApp();
</script>
</body>
</html>
